(self["webpackChunkhumbleshit_app"]=self["webpackChunkhumbleshit_app"]||[]).push([[230],{3230:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});a(246);var i=a(3673),s=a(2323);const l={class:"row q-col-gutter-md"},r={class:"text-weight-bol"},o={class:"row q-col-gutter-sm"},n={class:"col"},u={class:"col"};function c(e,t,a,c,d,m){const p=(0,i.up)("q-card-section"),h=(0,i.up)("q-separator"),g=(0,i.up)("q-input"),f=(0,i.up)("q-btn"),w=(0,i.up)("q-icon"),v=(0,i.up)("q-badge"),y=(0,i.up)("q-img"),W=(0,i.up)("q-avatar"),C=(0,i.up)("q-card"),b=(0,i.up)("q-page-sticky"),q=(0,i.up)("ImageCapture"),k=(0,i.up)("q-dialog"),D=(0,i.up)("q-page");return(0,i.wg)(),(0,i.j4)(D,{padding:""},{default:(0,i.w5)((()=>[(0,i.Wm)("div",l,[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(d.issueDetails,(a=>((0,i.wg)(),(0,i.j4)("div",{key:a._id,class:"col-12"},[(0,i.Wm)(C,{flat:"",bordered:""},{default:(0,i.w5)((()=>[(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)("div",r,(0,s.zw)(a.name),1)])),_:2},1024),(0,i.Wm)(h),(0,i.Wm)(p,null,{default:(0,i.w5)((()=>[(0,i.Wm)(g,{ref:"description",modelValue:a.description,"onUpdate:modelValue":e=>a.description=e,filled:"",autogrow:"",type:"textarea",rules:[e=>!!e],placeholder:"Enter Issue Details"},null,8,["modelValue","onUpdate:modelValue","rules"]),(0,i.Wm)("div",o,[(0,i.Wm)("div",n,[(0,i.Wm)(f,{rounded:"",label:"Capture Image",icon:"eva-image-outline",color:"primary",class:"full-width","no-caps":"",onClick:e=>m.captureImage(a)},null,8,["onClick"])]),(0,i.Wm)("div",u,[(0,i.Wm)(f,{rounded:"",outline:"",label:"Record Voice",icon:"eva-mic-outline",class:"full-width",color:"grey","no-caps":"",onClick:t[1]||(t[1]=t=>e.$q.notify({message:"Premium feature!",color:"orange"}))},{default:(0,i.w5)((()=>[(0,i.Wm)(v,{color:"orange",floating:"",transparent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{name:"stars",color:"white"})])),_:1})])),_:1})])])])),_:2},1024),a.media.length?((0,i.wg)(),(0,i.j4)(p,{key:0,class:"q-pb-none"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.j4)(i.HY,null,(0,i.Ko)(a.media,((e,t)=>((0,i.wg)(),(0,i.j4)(W,{key:t,size:"128px",rounded:"",class:"q-mr-sm q-mb-sm"},{default:(0,i.w5)((()=>[e.type.includes("image")?((0,i.wg)(),(0,i.j4)(y,{key:0,src:e.path},null,8,["src"])):((0,i.wg)(),(0,i.j4)(w,{key:1,name:"music"})),(0,i.Wm)(v,{class:"q-pa-none",floating:"",color:"red",onClick:e=>m.removeFile(a,t)},{default:(0,i.w5)((()=>[(0,i.Wm)(w,{name:"close",size:"sm"})])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:2},1024)):(0,i.ry)("",!0)])),_:2},1024)])))),128))]),(0,i.Wm)(b,{position:"bottom-right",offset:[18,18]},{default:(0,i.w5)((()=>[(0,i.Wm)(f,{fab:"",icon:"eva-arrow-forward-outline",color:"primary",onClick:m.saveReportAndSubmit},null,8,["onClick"])])),_:1}),(0,i.Wm)(k,{modelValue:d.captureDialog,"onUpdate:modelValue":t[2]||(t[2]=e=>d.captureDialog=e),maximized:""},{default:(0,i.w5)((()=>[(0,i.Wm)(q,{onCapture:m.handleCapture},null,8,["onCapture"])])),_:1},8,["modelValue"])])),_:1})}var d=a(515),m=a.n(d);a(9544),a(5363);const p={class:"text-h6"},h=(0,i.Uk)(" Capture Image "),g={class:"video-container"},f={ref:"webcam",autoplay:"",playsinline:"",muted:""};function w(e,t,a,s,l,r){const o=(0,i.up)("q-btn"),n=(0,i.up)("q-card-section"),u=(0,i.up)("q-card"),c=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(u,null,{default:(0,i.w5)((()=>[(0,i.Wm)(n,null,{default:(0,i.w5)((()=>[(0,i.Wm)("div",p,[h,(0,i.wy)((0,i.Wm)(o,{icon:"close",dense:"",flat:"",round:"",class:"float-right"},null,512),[[c]])])])),_:1}),(0,i.Wm)("div",g,[(0,i.Wm)("video",f,null,512)]),(0,i.Wm)(n,{class:"text-center"},{default:(0,i.w5)((()=>[(0,i.Wm)(o,{label:"Capture",color:"primary",onClick:r.capture},null,8,["onClick"])])),_:1})])),_:1})}a(9656);const v={emits:["capture"],data(){return{mediaStream:null,imageCapture:null,captured:null,width:this.$q.screen.width,height:this.$q.screen.height-64-78}},async mounted(){await this.startWebcam()},async unmounted(){this.stopWebcam()},methods:{async startWebcam(){var e={audio:!1,video:{facingMode:"environment",width:this.width,height:this.height}};try{this.mediaStream=await navigator.mediaDevices.getUserMedia(e);var t=this.$refs.webcam;t.srcObject=this.mediaStream,t.onloadedmetadata=function(e){t.play()};const a=this.mediaStream.getVideoTracks()[0];this.imageCapture=new ImageCapture(a)}catch(a){console.log(a.name+": "+a.message)}},async capture(){const e=this;try{function t(e,t){if(!t)return NaN;let a=Math.min(t.max,Math.max(t.min,e));return a=Math.round(a/t.step)*t.step,a}const{imageWidth:a,imageHeight:i}=await this.imageCapture.getPhotoCapabilities(),s=t(400,a),l=t(400,i),r=s&&l?{imageWidth:s,imageHeight:l}:null;await this.imageCapture.takePhoto(r).then((t=>{e.$emit("capture",t)}))}catch(a){console.log("takePhoto() error: ",a)}},async stopWebcam(){this.mediaStream.getTracks().forEach((e=>{e.stop()}))}}};var y=a(151),W=a(5589),C=a(8240),b=a(677),q=a(7518),k=a.n(q);v.render=w;const D=v;k()(v,"components",{QCard:y.Z,QCardSection:W.Z,QBtn:C.Z}),k()(v,"directives",{ClosePopup:b.Z});var _=a(1741),I=a(5474);const Z={name:"PageIssueDetails",components:{ImageCapture:D},data(){return{imageSrc:"",issueDetails:[],tempAudio:null,recording:!1,captureDialog:!1,captureIssue:null}},computed:{report(){return this.$store.getters["reports/report"]},issues(){return this.report.parameters.filter((e=>!e.statusOk))}},mounted(){this.$store.dispatch("general/setTitle","Issue Details"),this.initDetails()},methods:{initDetails(){this.issueDetails=this.issues.map((e=>m()(m()({},e),{},{parameter:e._id,media:[],description:""})))},captureImage(e){this.captureIssue=e,this.captureDialog=!0},async handleCapture(e){console.log({blob:e});let t=new File([e],"capture.jpg",{type:e.type});t=await(0,_.Z)(t,{maxSizeMB:.05}),this.uploadFile(t),this.captureDialog=!1},uploadFile(e){this.$q.loading.show();var t=new FormData;t.append("media",e),I.api.post("/uploads",t,{headers:{"content-type":"multipart/form-data"}}).then((e=>{let t=this.issueDetails.indexOf(this.captureIssue);this.issueDetails[t].media=e.data.concat(this.issueDetails[t].media),this.captureIssue=null})).catch((e=>console.error(e))).finally((()=>{this.$q.loading.hide()}))},removeFile(e,t){let a=this.issueDetails.indexOf(e),i=this.issueDetails[a].media[t];this.$q.loading.show(),I.api.delete("/uploads/"+i.name).then((e=>{this.issueDetails[a].media.splice(t,1)})).catch((e=>console.error(e))).finally((()=>{this.$q.loading.hide()}))},validate(){let e=!1;for(let t=0;t<this.$refs.description.length;t++){let a=this.$refs.description[t];a.validate(),e=e||a.hasError}return!e},saveReportAndSubmit(){if(this.validate()){let e=this.report.parameters.map((e=>m()(m()({},e),{},{parameter:e._id})));this.$store.dispatch("reports/saveReport",m()(m()({},this.report),{},{parameters:e,issueDetails:this.issueDetails})),this.$router.replace("/reports/submit")}else this.$q.notify({message:"Please enter data!",type:"negative"})}}};var Q=a(4379),$=a(5869),S=a(4842),j=a(9721),x=a(4554),P=a(5096),V=a(4027),F=a(1007),M=a(4390);Z.render=c;const z=Z;k()(Z,"components",{QPage:Q.Z,QCard:y.Z,QCardSection:W.Z,QSeparator:$.Z,QInput:S.Z,QBtn:C.Z,QBadge:j.Z,QIcon:x.Z,QAvatar:P.Z,QImg:V.Z,QPageSticky:F.Z,QDialog:M.Z})}}]);