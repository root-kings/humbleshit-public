(self["webpackChunkhumbleshit_app"]=self["webpackChunkhumbleshit_app"]||[]).push([[576],{8576:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>C});var l=i(3673);const a=(0,l.Uk)("Mappings"),s={class:"row q-col-gutter-sm"},o={class:"col-9"},n={class:"col-3"},d={class:"col-6"},u={class:"col-6"},r={class:"row"},p={class:"col-9"};function m(e,t,i,m,h,c){const f=(0,l.up)("q-input"),g=(0,l.up)("q-item-section"),v=(0,l.up)("q-item"),b=(0,l.up)("q-item-label"),w=(0,l.up)("q-separator"),W=(0,l.up)("q-select"),V=(0,l.up)("q-btn"),y=(0,l.up)("q-list"),_=(0,l.up)("q-card"),S=(0,l.up)("q-page-sticky"),k=(0,l.up)("q-page");return(0,l.wg)(),(0,l.j4)(k,{padding:""},{default:(0,l.w5)((()=>[h.shift?((0,l.wg)(),(0,l.j4)(_,{key:0,flat:"",bordered:""},{default:(0,l.w5)((()=>[(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{modelValue:h.shift.startTime,"onUpdate:modelValue":t[1]||(t[1]=e=>h.shift.startTime=e),outlined:"",label:"Start Time",mask:"##:##"},null,8,["modelValue"])])),_:1}),(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)(f,{modelValue:h.shift.endTime,"onUpdate:modelValue":t[2]||(t[2]=e=>h.shift.endTime=e),outlined:"",label:"End Time",mask:"##:##"},null,8,["modelValue"])])),_:1})])),_:1}),(0,l.Wm)(y,{separator:""},{default:(0,l.w5)((()=>[(0,l.Wm)(b,{header:""},{default:(0,l.w5)((()=>[a])),_:1}),(0,l.Wm)(w),((0,l.wg)(!0),(0,l.j4)(l.HY,null,(0,l.Ko)(h.shift.mappings,((e,t)=>((0,l.wg)(),(0,l.j4)(v,{key:e._id},{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)("div",s,[(0,l.Wm)("div",o,[(0,l.Wm)(f,{modelValue:e.facility.name,"onUpdate:modelValue":t=>e.facility.name=t,dense:"",outlined:"",label:"Facility",type:"text",disable:""},null,8,["modelValue","onUpdate:modelValue"])]),(0,l.Wm)("div",n,[(0,l.Wm)(f,{modelValue:e.interval,"onUpdate:modelValue":t=>e.interval=t,type:"number",dense:"",outlined:"",label:"Interval",mask:"#",suffix:"Hrs"},null,8,["modelValue","onUpdate:modelValue"])]),(0,l.Wm)("div",d,[(0,l.Wm)(W,{modelValue:e.supervisor,"onUpdate:modelValue":t=>e.supervisor=t,dense:"",outlined:"",options:c.supervisors,"emit-value":"","map-options":"","option-label":"name","option-value":"_id",placeholder:"User",label:"Supervisor"},null,8,["modelValue","onUpdate:modelValue","options"])]),(0,l.Wm)("div",u,[(0,l.Wm)(W,{modelValue:e.reporter,"onUpdate:modelValue":t=>e.reporter=t,dense:"",outlined:"",options:c.reporters,"emit-value":"","map-options":"","option-label":"name","option-value":"_id",placeholder:"User",label:"Reporter"},null,8,["modelValue","onUpdate:modelValue","options"])])])])),_:2},1024),(0,l.Wm)(g,{side:""},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{round:"",flat:"",dense:"",icon:"eva-close-outline",onClick:e=>c.removeMapping(t)},null,8,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),(0,l.Wm)(v,null,{default:(0,l.w5)((()=>[(0,l.Wm)(g,null,{default:(0,l.w5)((()=>[(0,l.Wm)("div",r,[(0,l.Wm)("div",p,[(0,l.Wm)(W,{modelValue:h.newMappingFacilityId,"onUpdate:modelValue":t[3]||(t[3]=e=>h.newMappingFacilityId=e),dense:"",outlined:"",options:c.filteredFacilities,"option-label":"name",label:"Add Facility"},null,8,["modelValue","options"])])])])),_:1})])),_:1})])),_:1})])),_:1})):(0,l.ry)("",!0),(0,l.Wm)(S,{position:"bottom-right",offset:[18,18]},{default:(0,l.w5)((()=>[(0,l.Wm)(V,{fab:"",icon:"eva-save-outline",color:c.hasChanged?"primary":"grey",disable:!c.hasChanged,onClick:c.saveShift},null,8,["color","disable","onClick"])])),_:1})])),_:1})}i(9544);var h=i(8603),c=i.n(h),f=i(5474);const g={props:{id:{type:String,default:null}},data(){return{shift:{startTime:null,endTime:null,mappings:[]},originalShift:null,newMappingFacilityId:null}},computed:{hasChanged(){return!c().isEqual(this.shift,this.originalShift)},allFacilities(){return this.$store.getters["facilities/facilities"]},reporters(){return this.$store.getters["users/possibleReporters"]},supervisors(){return this.$store.getters["users/possibleSupervisors"]},selectedFacilities(){return this.shift.mappings.map((e=>e.facility._id))},filteredFacilities(){return this.allFacilities.filter((e=>!this.selectedFacilities.includes(e._id)))}},watch:{newMappingFacilityId(e){e&&this.addMapping(e)}},mounted(){this.$store.dispatch("general/setTitle","Shift Details"),this.getShift(),this.getUsers(),this.getFacilities()},methods:{async getShift(){this.$q.loading.show(),f.api.get("/shifts/"+this.id).then((e=>{this.shift=e.data,this.originalShift=c().cloneDeep(this.shift)})).catch((e=>console.error(e))).finally((()=>{this.$q.loading.hide()}))},getUsers(){this.$store.dispatch("users/fetchAllStaff")},addMapping(e){this.shift.mappings.push({facility:e,supervisor:null,reporter:null,interval:2}),this.newMappingFacilityId=null},removeMapping(e){this.shift.mappings.splice(e,1)},getFacilities(){this.$store.dispatch("facilities/fetchFacilities")},saveShift(){f.api.put("/shifts/"+this.id,this.shift).then((e=>{this.getShift()})).catch((e=>console.error(e))).finally((()=>{this.$q.loading.hide()}))},deleteShift(){f.api.delete(`/shifts/${this.id}`).then((e=>this.$router.back()))}}};var v=i(4379),b=i(151),w=i(6332),W=i(2035),V=i(4842),y=i(7011),_=i(2350),S=i(5869),k=i(5735),q=i(7727),F=i(8240),U=i(1007),Q=i(7518),Z=i.n(Q);g.render=m;const C=g;Z()(g,"components",{QPage:v.Z,QCard:b.Z,QItem:w.Z,QItemSection:W.Z,QInput:V.Z,QList:y.Z,QItemLabel:_.Z,QSeparator:S.Z,QCheckbox:k.Z,QSelect:q.Z,QBtn:F.Z,QPageSticky:U.Z})}}]);